â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘        âœ… FONTES DE DADOS EXTERNAS - SINCRONIZAÃ‡ÃƒO AUTOMÃTICA       â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ FUNCIONALIDADE IMPLEMENTADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Agora vocÃª pode conectar bancos de dados EXTERNOS (MySQL, PostgreSQL) 
e importar contatos automaticamente para suas listas de campanhas!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“‹ INSTALAÃ‡ÃƒO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Rodar migrations:
   php database/migrate.php

2. Configurar cron (opcional, para sync automÃ¡tica):
   
   Windows Task Scheduler:
   - Programa: C:\laragon\bin\php\php.exe
   - Argumentos: C:\laragon\www\chat\public\scripts\process-external-sources.php
   - Repetir: A cada 1 hora

   Linux cron:
   0 * * * * php /var/www/html/public/scripts/process-external-sources.php


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸš€ COMO USAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASSO 1: CONFIGURAR FONTE EXTERNA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Acesse: Campanhas > Fontes Externas > Nova Fonte
2. Preencha:
   - Nome: Ex: "CRM Principal"
   - Tipo: MySQL ou PostgreSQL
   - Host: Ex: 192.168.1.100
   - Porta: 3306 (MySQL) ou 5432 (PostgreSQL)
   - Banco: nome_do_banco
   - UsuÃ¡rio: usuario
   - Senha: senha

3. Clique em "Testar ConexÃ£o"
   âœ… Se conectar, as prÃ³ximas opÃ§Ãµes aparecem

4. Selecione:
   - Tabela: Ex: "clientes"
   - Mapeamento de colunas:
     * Nome: nome_completo
     * Telefone: celular
     * Email: email

5. Configure sincronizaÃ§Ã£o:
   - FrequÃªncia: Manual, Hora em hora, DiÃ¡ria, Semanal
   - Filtro WHERE: Ex: status = 'ativo'
   - OrdenaÃ§Ã£o: Ex: created_at DESC
   - Limite: Ex: 1000

6. Clique em "Preview" para ver os dados
7. Salve a fonte


PASSO 2: USAR FONTE EM UMA LISTA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

OpÃ§Ã£o A - Via interface (futuro):
   Ao criar lista, vincular fonte externa

OpÃ§Ã£o B - Via banco:
   UPDATE contact_lists 
   SET external_source_id = 1, 
       sync_enabled = TRUE
   WHERE id = 10;

OpÃ§Ã£o C - Via API/cÃ³digo:
   $sourceId = 1;  // ID da fonte criada
   $listId = 10;   // ID da lista
   ExternalDataSourceService::sync($sourceId, $listId);


PASSO 3: CONFIGURAR ORDEM DE ENVIO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Em "Listas de Contatos", clique no botÃ£o "Ordem" de uma lista
2. Escolha:
   - PadrÃ£o: ordem que foram adicionados
   - AleatÃ³rio: embaralha contatos
   - Crescente (ASC): por ID ou outro campo
   - Decrescente (DESC): por ID ou outro campo  
   - Personalizado: SQL ORDER BY customizado

3. Opcionalmente, adicione filtro WHERE
4. Salve


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“Š EXEMPLOS PRÃTICOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EXEMPLO 1: Importar clientes do seu CRM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Fonte Externa:
   Nome: CRM Principal
   Tipo: MySQL
   Host: 192.168.1.50
   Banco: meu_crm
   Tabela: clientes
   Mapeamento:
      nome â†’ nome_completo
      phone â†’ telefone
      email â†’ email_contato
   Filtro WHERE: status = 'ativo' AND interesse = 'whatsapp'
   FrequÃªncia: DiÃ¡ria (sincroniza todo dia)

Resultado: 
   â†’ Todos os clientes ativos interessados em WhatsApp serÃ£o 
     importados automaticamente para sua lista!


EXEMPLO 2: Ordem inteligente de envio
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CenÃ¡rio: VocÃª quer enviar primeiro para clientes com maior ticket mÃ©dio

ConfiguraÃ§Ã£o:
   Ordem: Decrescente (DESC)
   Campo: ticket_medio
   
Ou personalizado:
   ORDER BY: CASE WHEN ticket_medio > 5000 THEN 1 ELSE 2 END, ticket_medio DESC


EXEMPLO 3: Filtrar apenas alguns contatos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CenÃ¡rio: Enviar apenas para SP e RJ

ConfiguraÃ§Ã£o:
   Filtro WHERE: estado IN ('SP', 'RJ')


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ”„ SINCRONIZAÃ‡ÃƒO AUTOMÃTICA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Se configurou frequÃªncia diferente de "Manual":
   âœ… Cron job sincroniza automaticamente
   âœ… Novos contatos aparecem na lista
   âœ… Contatos existentes sÃ£o atualizados
   âœ… Logs de cada sincronizaÃ§Ã£o sÃ£o salvos

Verificar logs:
   SELECT * FROM external_data_sync_logs 
   WHERE source_id = 1 
   ORDER BY started_at DESC 
   LIMIT 10;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“ ARQUIVOS CRIADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Migrations:
âœ… database/migrations/120_create_external_data_sources_table.php
âœ… database/migrations/121_add_external_source_to_contact_lists.php

Models:
âœ… app/Models/ExternalDataSource.php

Services:
âœ… app/Services/ExternalDataSourceService.php

Controllers:
âœ… app/Controllers/ExternalDataSourceController.php

Views:
âœ… views/external-sources/index.php
âœ… views/external-sources/create.php
âœ… views/contact-lists/send-order.php (modal)

Scripts:
âœ… public/scripts/process-external-sources.php (cron)

Rotas:
âœ… routes/web.php (adicionadas 13 novas rotas)

Menu:
âœ… views/layouts/metronic/sidebar.php (item "Fontes Externas")


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ¨ INTERFACE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Nova tela: /external-sources
   â†’ Listar fontes configuradas
   â†’ Ver status de sincronizaÃ§Ã£o
   â†’ Sincronizar manualmente
   â†’ Deletar fontes

Nova tela: /external-sources/create
   â†’ Wizard de 5 passos
   â†’ Teste de conexÃ£o em tempo real
   â†’ SeleÃ§Ã£o visual de tabelas/colunas
   â†’ Preview dos dados antes de salvar

Listas de Contatos: BotÃ£o "Ordem"
   â†’ Modal para configurar ordem de envio
   â†’ OpÃ§Ãµes: PadrÃ£o, AleatÃ³rio, ASC, DESC, Custom
   â†’ Preview SQL

Listas de Contatos: BotÃ£o "Fonte Externa"
   â†’ Link direto para criar fonte


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


âš™ï¸ CONFIGURAÃ‡Ã•ES AVANÃ‡ADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Mapeamento de Colunas Customizado:
   AlÃ©m de nome, telefone e email, vocÃª pode mapear campos extras:

   {
     "name": "nome_completo",
     "phone": "celular",
     "email": "email",
     "custom_fields": {
       "empresa": "razao_social",
       "cargo": "cargo",
       "cidade": "cidade"
     }
   }

Query Config AvanÃ§ada:
   {
     "where": "status = 'ativo' AND cidade IN ('SÃ£o Paulo', 'Rio')",
     "order_by": "prioridade DESC, created_at ASC",
     "limit": 5000
   }

Send Order Config:
   {
     "field": "ticket_medio",
     "direction": "desc",
     "where": "ticket_medio > 1000"
   }


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ” SEGURANÃ‡A
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Senhas de banco externo armazenadas em JSON (criptografar em produÃ§Ã£o)
âœ… Prepared statements em todas as queries
âœ… ValidaÃ§Ã£o de permissÃµes (campaigns.view, campaigns.create)
âœ… Logs de todas as sincronizaÃ§Ãµes
âœ… ConexÃµes isoladas (nÃ£o interfere no banco principal)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“ˆ MONITORAMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ver Ãºltimas sincronizaÃ§Ãµes:
   SELECT 
     eds.name as fonte,
     edsl.started_at,
     edsl.status,
     edsl.records_fetched,
     edsl.records_created,
     edsl.records_updated,
     edsl.records_failed,
     edsl.execution_time_ms
   FROM external_data_sync_logs edsl
   INNER JOIN external_data_sources eds ON edsl.source_id = eds.id
   ORDER BY edsl.started_at DESC
   LIMIT 20;


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ‰ PRONTO!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Agora vocÃª tem:
âœ… SincronizaÃ§Ã£o automÃ¡tica de bancos externos
âœ… Mapeamento flexÃ­vel de colunas
âœ… Ordem de envio customizÃ¡vel (aleatÃ³rio, ASC, DESC, SQL custom)
âœ… Preview antes de importar
âœ… Logs completos de sincronizaÃ§Ã£o
âœ… Cron job para automaÃ§Ã£o
âœ… Interface visual completa


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Data: 19/01/2026
  Status: âœ… FUNCIONALIDADE COMPLETA
  Sistema: PRONTO PARA USO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
